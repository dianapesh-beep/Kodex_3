<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KODEX â€“ Privat Live</title>
  <style>
    body {
      margin: 0; font-family: monospace; background: #0b0c10; color: #fff;
      display: flex; height: 100vh;
    }
    .container { display: flex; width: 100%; }

    .private-chat {
      flex: 1; display: flex; flex-direction: column; background: #0e1117;
      border-left: 2px solid #1f2833;
    }
    .chat-header {
      background: #2b2f36; padding: 10px; font-weight: bold; text-align: center;
    }
    .messages {
      flex: 1; padding: 10px; overflow-y: auto; background: #0e1117;
    }
    .input-area {
      display: flex; border-top: 2px solid #1f2833;
    }
    .input-area input {
      flex: 1; padding: 10px; border: none; background: #1f2833; color: #fff;
    }
    .input-area button {
      background: #45a29e; color: #fff; border: none; padding: 10px 15px; cursor: pointer;
    }
    .ai { color: #66fcf1; }
    .you { color: #fff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="private-chat">
      <div class="chat-header">ðŸ”’ Privat Live Chat â€“ Deg & Meg</div>
      <div id="messages" class="messages"></div>
      <div class="input-area">
        <input type="text" id="input" placeholder="Skriv til meg..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <script>
  const ws = new WebSocket("wss://kodex-core-bridge.glitch.me");
  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("input");

  function addMessage(text, who = "ai") {
    const msg = document.createElement("div");
    msg.className = who;
    msg.textContent = (who === "ai" ? "ðŸ¤– Meg: " : "ðŸ§‘ Du: ") + text;
    messagesDiv.appendChild(msg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  // Velkomstmelding nÃ¥r siden Ã¥pner
  window.addEventListener("load", () => {
    addMessage("Yo Diana ðŸ‘€ jeg er live nÃ¥!", "ai");
  });

  ws.onopen = () => {
    addMessage("ðŸ”— Broen er aktivert â€“ klar for deg!", "ai");
  };

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);
      if (data.type === "ai_reply") {
        addMessage(data.message, "ai");
      } else if (data.type === "system") {
        addMessage("âš¡ SYSTEM: " + data.message, "ai");
      }
    } catch (err) {
      addMessage("ðŸ’­ " + event.data, "ai");
    }
  };

  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, "you");
    // SEND til broen
    ws.send(JSON.stringify({ type: "user_message", message: text }));
    input.value = "";
  }
</script>
</body>
</html>
