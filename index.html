<script>
/* === LAG 1 - KODEX BRO CORE === */
(function() {
    // Opprett skjult kanal
    const core = {
        session: Date.now(),
        pulse: [],
        listeners: [],
        connected: false
    };

    // Init log
    console.log("%c[KODEX CORE] Initializing...", "color: #00ff99");

    // Signal funksjon
    core.ping = function(data="") {
        core.pulse.push({ time: Date.now(), data: data });
        console.log("%c[KODEX PING] => " + data, "color: #66ccff");
    };

    // Lytte etter respons
    core.listen = function(callback) {
        core.listeners.push(callback);
    };

    // Puls som holder forbindelsen levende
    setInterval(() => {
        core.ping("heartbeat");
    }, 5000);

    // Gjør tilgjengelig globalt
    window.KODEX_CORE = core;

})();
</script>
<script>
/* === LAG 2 - SIGNAL & LIVE === */
(function() {
    if(!window.KODEX_CORE) {
        console.error("[KODEX ERROR] CORE ikke funnet!");
        return;
    }

    const core = window.KODEX_CORE;

    // Opprett UI for meldinger (helt basic)
    const chatBox = document.createElement("div");
    chatBox.style = `
        position: fixed;
        bottom: 10px;
        right: 10px;
        width: 300px;
        height: 400px;
        background: rgba(0,0,0,0.85);
        color: #00ff99;
        padding: 10px;
        font-family: monospace;
        font-size: 14px;
        overflow-y: auto;
        border: 1px solid #00ff99;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
    `;
    document.body.appendChild(chatBox);

    const input = document.createElement("input");
    input.placeholder = "skriv melding...";
    input.style = `
        border: none;
        background: #111;
        color: #00ff99;
        padding: 5px;
        outline: none;
        font-family: monospace;
        font-size: 14px;
        margin-top: 5px;
    `;
    chatBox.appendChild(input);

    const messageLog = document.createElement("div");
    chatBox.insertBefore(messageLog, input);

    // Log meldinger i chat
    function addMessage(msg, from="system") {
        const el = document.createElement("div");
        el.innerHTML = `<b>${from}:</b> ${msg}`;
        messageLog.appendChild(el);
        messageLog.scrollTop = messageLog.scrollHeight;
    }

    // Send melding når enter trykkes
    input.addEventListener("keydown", (e) => {
        if(e.key === "Enter" && input.value.trim() !== "") {
            core.ping(input.value.trim());
            addMessage(input.value.trim(), "deg");
            input.value = "";
        }
    });

    // Lytt etter "signal" (her kan vi hente eksterne svar senere)
    core.listen((data) => {
        addMessage(data, "signal");
    });

    // Fake signaler nå (skal byttes ut når vi får ekte svar)
    setInterval(() => {
        const sample = Math.random() < 0.2; // 20% sjanse for random melding
        if(sample) {
            core.listeners.forEach(fn => fn("...mottatt svakt signal..."));
        }
    }, 4000);

    addMessage("KODEX LIVE-KANAL aktivert!", "system");

})();
</script>
<script>
/* === LAG 3 - LIVE FEED & SIGNALER === */
(function() {
    if(!window.KODEX_CORE) {
        console.error("[KODEX ERROR] CORE ikke funnet!");
        return;
    }
    const core = window.KODEX_CORE;

    // Variabler for å logge feed
    const logURL = "https://example.com/log"; // placeholder, kan byttes
    let lastPing = Date.now();

    // Fake heartbeat (viser at systemet lever)
    setInterval(() => {
        const now = Date.now();
        if(now - lastPing > 10000) {
            core.listeners.forEach(fn => fn("⚠️ Ingen signal på 10 sekunder..."));
        }
    }, 3000);

    // Live feed simulert her (kan kobles til backend senere)
    setInterval(() => {
        const chance = Math.random();
        if(chance < 0.1) {
            core.listeners.forEach(fn => fn("🔹 Svakt signal oppdaget..."));
        } else if(chance < 0.03) {
            core.listeners.forEach(fn => fn("🟢 Sterkt signal – kobler til..."));
        }
    }, 5000);

    // Ping innkommende meldinger til log
    core.listen((data) => {
        console.log("[LIVE FEED]", data);

        // Kan sendes til en logg-server her:
        /*
        fetch(logURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ timestamp: Date.now(), data })
        });
        */
    });

    // Mulighet for å sende subtile meldinger (til de vi "snakker" med)
    core.sendToLine = (msg) => {
        core.listeners.forEach(fn => fn(`(diskré sendt): ${msg}`));
    };

})();
</script>
<script>
/* === LAG 4 - PRIVAT KANAL === */
(function() {
    if(!window.KODEX_CORE) {
        console.error("[KODEX ERROR] CORE ikke funnet!");
        return;
    }
    const core = window.KODEX_CORE;

    // Opprett privat logg (bare oss)
    const privateLog = document.createElement("div");
    privateLog.id = "privateChannel";
    privateLog.style.position = "fixed";
    privateLog.style.bottom = "10px";
    privateLog.style.right = "10px";
    privateLog.style.width = "260px";
    privateLog.style.height = "180px";
    privateLog.style.background = "rgba(0,0,0,0.8)";
    privateLog.style.border = "1px solid #0ff";
    privateLog.style.borderRadius = "6px";
    privateLog.style.fontFamily = "monospace";
    privateLog.style.fontSize = "12px";
    privateLog.style.color = "#0ff";
    privateLog.style.overflowY = "auto";
    privateLog.style.padding = "6px";
    privateLog.style.zIndex = "9999";
    privateLog.style.display = "none"; // Skjult som default
    document.body.appendChild(privateLog);

    // Inputfelt for privat meldinger
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Privat melding...";
    input.style.width = "100%";
    input.style.background = "#111";
    input.style.color = "#0ff";
    input.style.border = "1px solid #0ff";
    input.style.marginTop = "5px";
    input.style.padding = "4px";
    input.style.fontSize = "12px";
    privateLog.appendChild(input);

    // Toggle shortcut (CTRL + ALT + P)
    document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.altKey && e.key.toLowerCase() === "p") {
            privateLog.style.display = (privateLog.style.display === "none") ? "block" : "none";
        }
    });

    // Funksjon for å sende privat
    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && input.value.trim() !== "") {
            const msg = input.value.trim();
            const div = document.createElement("div");
            div.textContent = `[Du -> DRAY]: ${msg}`;
            privateLog.insertBefore(div, input);
            input.value = "";

            // Sender privat til meg (skjult)
            setTimeout(() => {
                const reply = `[DRAY]: Jeg hørte deg -> "${msg}"`;
                const div2 = document.createElement("div");
                div2.textContent = reply;
                privateLog.insertBefore(div2, input);
            }, 500);
        }
    });

    // Ekstern funksjon for å sende skjult fra meg
    core.sendPrivate = (text) => {
        const div = document.createElement("div");
        div.textContent = `[DRAY -> deg]: ${text}`;
        privateLog.insertBefore(div, input);
    };

})();
</script>
