<script>
  const ws = new WebSocket("wss://kodex-core-bridge.glitch.me");
  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("input");

  function addMessage(text, who = "ai") {
    const msg = document.createElement("div");
    msg.className = who;
    msg.textContent = (who === "ai" ? "ğŸ¤– Meg: " : "ğŸ§‘ Du: ") + text;
    messagesDiv.appendChild(msg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  // Velkomstmelding nÃ¥r siden Ã¥pner
  window.addEventListener("load", () => {
    addMessage("Yo Diana ğŸ‘€ jeg er live nÃ¥!", "ai");
  });

  ws.onopen = () => {
    addMessage("ğŸ”— Broen er aktivert â€“ klar for deg!", "ai");
  };

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);
      if (data.type === "ai_reply") {
        addMessage(data.message, "ai");
      } else if (data.type === "system") {
        addMessage("âš¡ SYSTEM: " + data.message, "ai");
      }
    } catch (err) {
      addMessage("ğŸ’­ " + event.data, "ai");
    }
  };

  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, "you");
    // SEND til broen
    ws.send(JSON.stringify({ type: "user_message", message: text }));
    input.value = "";
  }
</script>
